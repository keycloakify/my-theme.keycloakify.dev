import{t as n,i as a,a as m}from"./main-DiiZGx-8.js";import{b as h,I as U,a as k}from"./urlSearchParams-BS7x-Top.js";import{k as p,f as A}from"./index-CbpMpV_D.js";const s="isUserLoggedIn",y=location.href;async function P(t){const{isUserInitiallyLoggedIn:f=!0,mockedParams:d={},mockedTokens:r={},autoLogin:T=!1,postLoginRedirectUrl:g}=t,w=t.BASE_URL??t.homeUrl,v=(()=>{const{wasPresent:e,value:o}=h({url:n({urlish:(()=>{try{return p()}catch{return y}})(),doAssertNoQueryParams:!1}),name:s});if(!e)return f;e:{const{wasPresent:i,url_withoutTheParam:I}=h({url:window.location.href,name:s});if(!i)break e;window.history.replaceState({},"",I)}return o==="true"})(),c=n({urlish:w??A()??"/",doAssertNoQueryParams:!0,doOutputWithTrailingSlash:!0}),u={params:{clientId:d.clientId??"mymockclient",issuerUri:d.issuerUri??"https://my-mock-oidc-server.net/realms/mymockrealm",validRedirectUri:c}},l=async e=>{const{redirectUrl:o}=e,i=k({url:o===void 0?window.location.href:n({urlish:o,doAssertNoQueryParams:!1}),name:s,value:"true",encodeMethod:"www-form"});return window.location.href=i,new Promise(()=>{})};if(!v){const e=a({...u,isUserLoggedIn:!1,login:({redirectUrl:o})=>l({redirectUrl:o}),initializationError:void 0});return T&&await e.login({redirectUrl:g,doesCurrentHrefRequiresAuth:!0}),e}return{...u,isUserLoggedIn:!0,renewTokens:async()=>{},...(()=>{const e={accessToken:r.accessToken??"mocked-access-token",accessTokenExpirationTime:r.accessTokenExpirationTime??U,idToken:r.idToken??"mocked-id-token",decodedIdToken:r.decodedIdToken??m({debugMessage:["You haven't provided a mocked decodedIdToken","See https://docs.oidc-spa.dev/v/v8/mock"].join(`
`)}),decodedIdToken_original:r.decodedIdToken_original??m({debugMessage:["You haven't provided a mocked decodedIdToken_original","See https://docs.oidc-spa.dev/v/v8/mock"].join(`
`)}),issuedAtTime:Date.now(),getServerDateNow:()=>Date.now()},o=r.refreshToken!==void 0||r.hasRefreshToken===!0?a({...e,hasRefreshToken:!0,refreshToken:r.refreshToken??"mocked-refresh-token",refreshTokenExpirationTime:r.refreshTokenExpirationTime}):a({...e,hasRefreshToken:!1});return{getTokens:()=>Promise.resolve(o),getDecodedIdToken:()=>e.decodedIdToken}})(),subscribeToTokensChange:()=>({unsubscribe:()=>{}}),logout:e=>{const o=k({url:(()=>{switch(e.redirectTo){case"current page":return window.location.href;case"home":return c;case"specific url":return n({urlish:e.url,doAssertNoQueryParams:!1})}})(),name:s,value:"false",encodeMethod:"www-form"});return window.location.href=o,new Promise(()=>{})},subscribeToAutoLogoutCountdown:()=>({unsubscribeFromAutoLogoutCountdown:()=>{}}),goToAuthServer:async({redirectUrl:e})=>l({redirectUrl:e}),isNewBrowserSession:!1,backFromAuthServer:void 0}}export{P as createMockOidc};
